# 要求定義書

## 1. システムの概観

### 1.1 目的

現在、タスクやナレッジの管理をNotionで行っているが、一部のタスク管理はスプレッドシートで行っており、Notionへ移行したいと考えている。スプレッドシートでは外部データソース（Webサイトのスクレイピング等）からデータを取得し、関数などでテーブルを加工してタスク管理用のテーブルを作成している。

Notionではスクレイピング等によるデータ取得ができないため、スプレッドシートで外部データを取得・加工し、加工後のデータをNotionのデータベースに送ることで、データ管理の一元化を実現する。

**解決したい課題：**
- スプレッドシートとNotionでのタスク管理の分散
- 外部データの手動転記作業の効率化
- データ管理の一元化

### 1.2 使用環境

- **利用場所：** 個人のPCから使用
- **利用シーン：** 外部データの取得・加工後に、定期的にNotionデータベースへデータを連携
- **外部公開：** なし（個人利用のみ、ただし開発コードはGitHub等で公開予定）

### 1.3 利用者

- **主要利用者：** システム開発者本人（1名）
    - ITスキル：高い（ITエンジニア）
    - 業務経験：ソフトウェア開発経験あり
    - 利用頻度：不定期（外部データ更新に応じて）

### 1.4 前提条件

- GoogleスプレッドシートとNotionの両方を使用可能であること
- Notion APIの利用が可能であること
- Google Apps Script（GAS）での開発が可能であること
- claspを使用したローカル開発環境が構築可能であること

## 2. システム要求

### 2.1 機能要求

システムに実装する機能を一覧で記述します。

| 機能ID | 機能名 | 概要 | 理由 | 重要度 | 実装時期 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| F-001 | データインポート機能 | スプレッドシートからNotionデータベースへのデータ連携 | メイン機能 | 高 | フェーズ1 |
| F-002 | チェックボックストリガー | チェックボックスクリック時の自動インポート実行 | 操作性向上 | 高 | フェーズ1 |
| F-003 | カラムマッピング設定 | スプレッドシートとNotionのカラム対応設定 | 柔軟性確保 | 高 | フェーズ1 |
| F-004 | エラーハンドリング | インポート失敗時のポップアップ通知 | 信頼性向上 | 高 | フェーズ1 |
| F-005 | 設定管理機能 | Notion API認証情報・DB ID等の設定管理 | セキュリティ・運用性 | 高 | フェーズ1 |
| F-006 | テンプレート機能 | 再利用可能なスプレッドシートテンプレート | 運用効率化 | 中 | フェーズ1 |
| F-007 | データ更新機能 | 既存Notionページの更新（主キーベース） | データメンテナンス | 中 | フェーズ2 |

### 2.2 データ要求

**主要データ項目：**
- スプレッドシートデータ：外部データソースから取得・加工されたテーブルデータ
- カラムマッピング情報：スプレッドシートとNotionプロパティの対応関係
- 設定情報：Notion API認証情報、データベースID
- インポート状態：各レコードの処理状況（未処理/処理済み/エラー）

**データフロー：**
1. 外部データソース → スプレッドシート（IMPORTHTML等で取得・加工）※本システム対象外
2. スプレッドシート → Notion API → Notionデータベース（本システムで実装）

### 2.3 設計要求

- **プラットフォーム：** Google Apps Script（GAS）
- **開発環境：** clasp使用によるローカル開発
- **API：** Notion API v1以降
- **認証方式：** Notion Integration Token

### 2.4 性能要求

- **処理速度：** 1レコードあたり5秒以内での連携完了
- **スループット：** 同時処理は不要（手動・個別実行）
- **信頼性：** API接続エラー時の適切なエラーハンドリング
- **可用性：** Google Apps Scriptの稼働率に依存

### 2.5 外部インターフェース要求

**連携先システム：**
- システム名：Notion
- インターフェース方式：REST API
- データフォーマット：JSON
- 認証方式：Bearer Token（Integration Token）

**API要件：**
- Notion API v1以降を使用
- ページ作成・更新機能の利用
- データベースプロパティの動的対応

### 2.6 UI要求

**ユーザーインターフェース：**
- 基盤：Googleスプレッドシート
- 操作方式：チェックボックスによるトリガー実行
- フィードバック：ポップアップによる結果通知
- 設定画面：スプレッドシート内の専用シート

### 2.7 ハードウェア要求

- **稼働環境：** Google Apps Scriptクラウド環境
- **クライアント要件：** Webブラウザ（Googleスプレッドシート対応）
- **ネットワーク：** インターネット接続必須

### 2.8 ソフトウェア要求

**開発・実行環境：**
- **プラットフォーム：** Google Apps Script
- **開発ツール：** clasp（Command Line Apps Script Projects）
- **API：** Notion API
- **ブラウザ：** Google Chrome推奨（Googleスプレッドシート用）

### 2.9 セキュリティ要求

**認証・認可：**
- Notion Integration Tokenによる認証
- アクセス権限は最小限に設定

**データ保護：**
- 機密情報の適切な管理（API Token等）
- スプレッドシート内設定シートまたはGASプロパティサービスでの保存
- 個人利用のため外部アクセス制御は対象外

### 2.10 国際化・輸出に関する要求

**対応言語：** 日本語のみ
**輸出管理：** 個人利用のため該当なし
**多言語対応：** 現時点では不要

### 2.11 スケジュール要求

**開発フェーズ：**
- フェーズ1：基本機能実装（新規データインポート、設定管理、エラーハンドリング）
- フェーズ2：拡張機能実装（データ更新機能）

**重要な期日：** 特になし（個人プロジェクトのため）

### 2.12 文書化要求

**作成が必要なドキュメント：**
- 要件定義書
- システム設計書
- モジュール・クラス詳細設計書
- 操作マニュアル（README.md）
- API仕様書

**コード公開：** GitHub等でのソースコード公開予定

### 2.13 トレーニング要求

**トレーニングの要否：** 不要
**理由：** 利用者が開発者本人であり、システム仕様を熟知しているため

### 2.14 導入・移行要求

**テンプレート配布：**
- スプレッドシートテンプレートの作成
- GASコードの組み込み
- 設定手順の文書化

**移行手順：**
1. テンプレートスプレッドシートのコピー作成
2. 設定シートでのNotion API情報設定
3. カラムマッピングの設定
4. データインポートの実行テスト

## 3. 代替機能要求

**サードパーティー製品調査：**
現時点では、GoogleスプレッドシートからNotionへの直接的なデータ連携を提供する既存サービスは限定的であり、カスタマイズ性や柔軟性を考慮すると独自開発が適している。

**代替案：**
- Zapier等の連携サービス：カスタマイズ性に制限、コスト発生
- 手動でのデータ転記：非効率、ヒューマンエラーのリスク
- CSV経由での連携：中間ファイル管理の煩雑さ

**結論：** 独自開発による実装が最適

## 4. 受け入れ基準

**基本機能の受け入れテスト：**

1. **データインポート機能**
   - チェックボックスをクリックした際に、対象行のデータがNotionデータベースに正常に登録される
   - スプレッドシートのカラムとNotionプロパティが正しくマッピングされる
   - 異なるデータ型（テキスト、数値、日付、セレクト等）が正しく変換される

2. **エラーハンドリング**
   - API接続エラー時に適切なポップアップメッセージが表示される
   - データ形式エラー時に具体的なエラー内容が通知される
   - エラー発生時もシステムが停止しない

3. **設定管理機能**
   - Notion API認証情報が安全に保存・取得できる
   - データベースIDの設定変更が反映される
   - カラムマッピング設定が正常に動作する

4. **テンプレート機能**
   - テンプレートスプレッドシートがコピー可能である
   - コピー後のスプレッドシートでGASが正常に動作する
   - 設定変更により異なるNotionデータベースに連携できる

**合格基準：**
- 全ての基本機能テストが成功すること
- エラーハンドリングが適切に動作すること
- ドキュメント（操作マニュアル）通りに操作できること

**拡張機能の受け入れテスト（フェーズ2）：**
- 主キー情報を使用した既存ページの更新が正常に動作する
- 新規作成と更新の判定が正しく行われる
